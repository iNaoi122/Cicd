# ๐ณ Docker Compose Setup ะดะปั RaceTracker

ะะพะปะฝะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั RaceTracker ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Docker Compose.

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Docker Engine 20.10+
- Docker Compose 2.0+
- ะะพััั 80 ะธ 8000 ะดะพัััะฟะฝั ะฝะฐ ะปะพะบะฐะปัะฝะพะน ะผะฐัะธะฝะต

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```bash
cd /home/sergey/University/cicd
docker-compose up -d
```

### 2. ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะพะฒ

```bash
docker-compose ps
```

ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:
```
NAME                   STATUS
racetracker-backend    Up
racetracker-frontend   Up
```

## ๐ ะะพัััะฟ ะบ ะฟัะธะปะพะถะตะฝะธั

### Frontend (ะะตะฑ-ะธะฝัะตััะตะนั)
- **URL**: http://localhost
- ะัะธะปะพะถะตะฝะธะต ะทะฐะณััะถะฐะตััั ะบะฐะบ Single Page Application (SPA)
- ะะฐัััััะธะทะฐัะธั ะฝะฐ ะพัะฝะพะฒะต ัะตัะฐ (#/races, #/jockeys, #/horses)

### Backend API
- **URL**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs (Swagger UI)
- **API Endpoint**: http://localhost/api/v1 (ัะตัะตะท Nginx proxy)

### Health Check
```bash
curl http://localhost:8000/health
# ะัะฒะตั: {"status": "healthy"}
```

## ๐ก API Endpoints

### Races (ะกะพัััะทะฐะฝะธั)
- `GET /api/v1/races` - ะะพะปััะธัั ะฒัะต ัะพัััะทะฐะฝะธั
- `GET /api/v1/races/{id}` - ะะพะปััะธัั ัะพัััะทะฐะฝะธะต ะฟะพ ID
- `POST /api/v1/races` - ะกะพะทะดะฐัั ะฝะพะฒะพะต ัะพัััะทะฐะฝะธะต

### Jockeys (ะะพะบะตะธ)
- `GET /api/v1/jockeys` - ะะพะปััะธัั ะฒัะตั ะถะพะบะตะตะฒ
- `GET /api/v1/jockeys/{id}` - ะะพะปััะธัั ะถะพะบะตั ะฟะพ ID
- `GET /api/v1/jockeys/{id}/races` - ะะพะปััะธัั ัะพัััะทะฐะฝะธั ะถะพะบะตั
- `POST /api/v1/jockeys` - ะกะพะทะดะฐัั ะฝะพะฒะพะณะพ ะถะพะบะตั

### Horses (ะะพัะฐะดะธ)
- `GET /api/v1/horses` - ะะพะปััะธัั ะฒัะตั ะปะพัะฐะดะตะน
- `GET /api/v1/horses/{id}` - ะะพะปััะธัั ะปะพัะฐะดั ะฟะพ ID
- `GET /api/v1/horses/{id}/races` - ะะพะปััะธัั ัะพัััะทะฐะฝะธั ะปะพัะฐะดะธ
- `POST /api/v1/horses` - ะกะพะทะดะฐัั ะฝะพะฒัั ะปะพัะฐะดั

### Owners (ะะปะฐะดะตะปััั)
- `GET /api/v1/owners` - ะะพะปััะธัั ะฒัะตั ะฒะปะฐะดะตะปััะตะฒ
- `GET /api/v1/owners/{id}` - ะะพะปััะธัั ะฒะปะฐะดะตะปััะฐ ะฟะพ ID
- `POST /api/v1/owners` - ะกะพะทะดะฐัั ะฝะพะฒะพะณะพ ะฒะปะฐะดะตะปััะฐ

### Participants (ะฃัะฐััะฝะธะบะธ)
- `GET /api/v1/participants` - ะะพะปััะธัั ะฒัะตั ััะฐััะฝะธะบะพะฒ
- `POST /api/v1/participants` - ะะพะฑะฐะฒะธัั ััะฐััะฝะธะบะฐ ะฒ ัะพัััะทะฐะฝะธะต

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         Frontend (Nginx)                โ
โ  HTML/CSS/JavaScript (Vanilla)          โ
โ  Port 80                                โ
โ  FSD Architecture                       โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ HTTP Requests (via /api proxy)
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      Backend (FastAPI)                  โ
โ  Python 3.11 with SQLAlchemy            โ
โ  Port 8000                              โ
โ  SQLite In-Memory Database              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะััะฐะฝะพะฒะบะฐ ะฟัะธะปะพะถะตะฝะธั

```bash
docker-compose down
```

## ๐ ะะพะณะธ

### ะะพัะผะพััะตัั ะปะพะณะธ backend
```bash
docker logs racetracker-backend -f
```

### ะะพัะผะพััะตัั ะปะพะณะธ frontend
```bash
docker logs racetracker-frontend -f
```

## ๐ง ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

### Backend (.env ะฒ ะบะพะฝัะตะนะฝะตัะต)
- `DATABASE_URL`: `sqlite+aiosqlite:///:memory:` (SQLite ะฒ ะฟะฐะผััะธ)
- `PYTHONUNBUFFERED`: `1` (ะะพะณะธัะพะฒะฐะฝะธะต ะฑะตะท ะฑััะตัะธะทะฐัะธะธ)

### Frontend (.env)
- `API_BASE_URL`: `/api` (ะััั ะบ API, ะฟัะพะบัะธััะตััั ัะตัะตะท Nginx)

## ๐ Troubleshooting

### ะัะธะฑะบะฐ: "Port 80 already allocated"
```bash
# ะะฐะนัะธ ะฟัะพัะตัั ะธัะฟะพะปัะทัััะธะน ะฟะพัั 80
sudo lsof -i :80

# ะััะฐะฝะพะฒะธัั ะฟัะพัะตัั ะธะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ะดััะณะพะน ะฟะพัั
docker-compose down
```

### ะัะธะฑะบะฐ: "Port 8000 already allocated"
```bash
# ะััะฐะฝะพะฒะธัั ััะฐััะต ะบะพะฝัะตะนะฝะตัั
docker stop $(docker ps -q --filter ancestor=<image-name>)
docker-compose up -d
```

### Frontend ะฝะต ะทะฐะณััะถะฐะตััั
- ะัะพะฒะตัััะต ะปะพะณะธ nginx: `docker logs racetracker-frontend`
- ะฃะฑะตะดะธัะตัั ััะพ index.html ะธ src/ ัะบะพะฟะธัะพะฒะฐะฝั ะฒ ะบะพะฝัะตะนะฝะตั
- ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั ะฟัะธะปะพะถะตะฝะธั: `curl http://localhost/`

### API ะฝะต ะพัะฒะตัะฐะตั
- ะัะพะฒะตัััะต ะปะพะณะธ backend: `docker logs racetracker-backend`
- ะฃะฑะตะดะธัะตัั ััะพ backend ะทะฐะฟััะตะฝ: `docker ps | grep racetracker-backend`
- ะัะพะฒะตัััะต health: `curl http://localhost:8000/health`

## ๐ ะะพะปัะผั ะธ ัะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั

ะขะตะบััะฐั ะบะพะฝัะธะณััะฐัะธั ะธัะฟะพะปัะทัะตั **SQLite ะฒ ะฟะฐะผััะธ**, ะฟะพััะพะผั ะดะฐะฝะฝัะต ัะตัััััั ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต ะบะพะฝัะตะนะฝะตัะฐ.

ะะปั ัะพััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะฝะตะพะฑัะพะดะธะผะพ:
1. ะะทะผะตะฝะธัั `DATABASE_URL` ะฝะฐ SQLite ัะฐะนะป ะฝะฐ ะดะธัะบะต
2. ะะพะฑะฐะฒะธัั volume ะดะปั ะฟะฐะฟะบะธ ะดะฐะฝะฝัั
3. ะะปะธ ะธัะฟะพะปัะทะพะฒะฐัั PostgreSQL ะบะพะฝัะตะนะฝะตั

## ๐ Security Notes

- CORS ะฝะฐัััะพะตะฝ ะดะปั ะปะพะบะฐะปัะฝะพะณะพ ะดะพัััะฟะฐ
- Database URL hardcoded - ะฝะต ะธัะฟะพะปัะทะพะฒะฐัั ะฒ production
- Nginx ะบะพะฝัะธะณััะฐัะธั ะฑะตะท HTTPS - ะดะพะฑะฐะฒะธัั SSL ัะตััะธัะธะบะฐั ะดะปั production

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะพ

### ะััะฐะฝะพะฒะบะฐ ะพัะดะตะปัะฝะพะณะพ ะบะพะฝัะตะนะฝะตัะฐ
```bash
docker-compose stop racetracker-backend
docker-compose start racetracker-backend
```

### ะะตัะตัััะพะธัั ะบะพะฝัะตะนะฝะตัั
```bash
docker-compose build --no-cache
docker-compose up -d
```

### ะัะธััะธัั ะฒัะต ะดะฐะฝะฝัะต Docker
```bash
docker-compose down -v
docker system prune -a
```

---

**ะกัะฐััั**: โ ะะพัะพะฒะพ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต**: 2026-02-09
